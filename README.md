# Hermes

APC (Agent Client Protocol) client

## Overview

Hermes implements the Agent Client Protocol designed for integration with Neovim. It enables Neovim to communicate with AI coding agents following the standardized APC specification.

The goal of Hermes is to be a bridge between AI assistant coding tools and Neovim while making no assumptions about how the user want's to use APC communication in their Neovim setup.

Hermes currently has no UI (and may never), it exposes an api for making requests, hooks into requests that require responses, and autocommands for updates from an agent. You could use these to build any kind of workflow/UI you would like in Neovim. 

- Hermes publishes autocommands for each event recieved from an Agent that requires no response.
- Hermes provides an api for connecting to and sending requests to agents
- For requests that require responses (permissions, read requests, etc), You can provide hooks/callbacks into these requests, default implementations exist for some, but not all, of these hooks/callbacks. 

## Features

- [x] Full implementation of APC Client
- [x] Configurable capabilities (filesystem, terminal, etc)
- [x] Trigger Autocommands for messages/notifications
- [ ] Allow connectiing to Agents
  - [ ] Via stdio
  - [ ] Via http
  - [ ] Via linux socket
  - [ ] handle authentication
- [ ] Allow mode selection
- [ ] Allow model selection
- [ ] Allow agent to write to files
  - [ ] Automatically refresh open buffers that have been modified
- [ ] Allow agent to read files
- [ ] Allow agent to use terminal
  - [ ] Create autocommands for Agent progress in the terminal
- [ ] Allow user to give permission when needed
- [ ] Allow user to configure/turn off any/all aspects of APC (if, for example, you just want to send data to the agent but still interact with it via the CLI)
- [ ] Allow user to send prompts
  - [ ] Send files
  - [ ] Send text
  - [ ] Send images 
  - [ ] Send resource links
  - [ ] Send audio
  - [ ] Cancel

## Autocommands

Hermes generates autocommands for all messages sent between agent and client. Each autocommand has the data section of their argument populated by information from these interactions. Below is an example of hooking into an autocommand generated by hermes:

```lua
vim.api.nvim_create_autocmd("AgentTextMessage", {
    group = "Hermes",
    pattern = { "*" },
    callback = function(args)
        print("Recieved some text from our assistant: " .. args.data.text)
    end,
})
```

Below is a list of all autocommands, their purpose, and the data passed into the args of their respective callback functions.

<table>
  <thead>
    <tr>
      <th>Autocommand</th>
      <th>Description</th>
      <th>Data</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>ClientTextMessage</code></td>
      <td>Message text sent from the client</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "text": "string",
  "type": "text",
  "annotations": {
    "audience": ["Role1", "Role2"],
    "last_modified": "ISO8601 string",
    "priority": "number"
  },
  "meta": "JSON value"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>ClientImageMessage</code></td>
      <td>An image sent from the Client</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "data": "base64 string",
  "mimeType": "string",
  "type": "image",
  "uri": "string (optional)",
  "annotations": { "audience": [], "priority": 1 },
  "meta": "JSON value"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>ClientResourceMessage</code></td>
      <td>A resource sent from the Client</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "resource": {
    "text": "string (if text resource)",
    "blob": "string (if blob resource)",
    "uri": "string",
    "mimeType": "string (optional)"
  },
  "type": "resource",
  "annotations": { "audience": [], "last_modified": "string" },
  "meta": "JSON value"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>ClientResourceLinkMessage</code></td>
      <td>A resource link from the Client</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "name": "string",
  "uri": "string",
  "type": "resourcelink",
  "description": "string (optional)",
  "mimeType": "string (optional)",
  "size": "number (optional)",
  "title": "string (optional)",
  "annotations": { "audience": [], "priority": 1 },
  "meta": "JSON value"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentTextMessage</code></td>
      <td>a text message from the agent</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "text": "string",
  "type": "text",
  "annotations": { "audience": [], "priority": 1 },
  "meta": "JSON value"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentImageMessage</code></td>
      <td>an image from the agent</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "data": "base64 string",
  "mimeType": "string",
  "type": "image",
  "uri": "string (optional)",
  "annotations": { "audience": [], "priority": 1 },
  "meta": "JSON value"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentResourceMessage</code></td>
      <td>a resource from the agent</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "resource": {
    "text": "string (if text resource)",
    "blob": "string (if blob resource)",
    "uri": "string",
    "mimeType": "string (optional)"
  },
  "type": "resource",
  "annotations": { "audience": [], "last_modified": "string" },
  "meta": "JSON value"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentResourceLinkMessage</code></td>
      <td>a resource link from the agent</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "name": "string",
  "uri": "string",
  "type": "resourcelink",
  "description": "string (optional)",
  "mimeType": "string (optional)",
  "size": "number (optional)",
  "title": "string (optional)",
  "annotations": { "audience": [], "priority": 1 },
  "meta": "JSON value"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentTextThought</code></td>
      <td>text-based reasoning from the agent</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "text": "string",
  "type": "text",
  "annotations": { "audience": [], "priority": 1 },
  "meta": "JSON value"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentImageThought</code></td>
      <td>image-based reasoning from the agent</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "data": "base64 string",
  "mimeType": "string",
  "type": "image",
  "uri": "string (optional)",
  "annotations": { "audience": [], "priority": 1 },
  "meta": "JSON value"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentResourceThought</code></td>
      <td>resource-based reasoning from the agent</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "resource": {
    "text": "string (if text resource)",
    "blob": "string (if blob resource)",
    "uri": "string",
    "mimeType": "string (optional)"
  },
  "type": "resource",
  "annotations": { "audience": [], "last_modified": "string" },
  "meta": "JSON value"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentResourceLinkThought</code></td>
      <td>resource link reasoning from the agent</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "name": "string",
  "uri": "string",
  "type": "resourcelink",
  "description": "string (optional)",
  "mimeType": "string (optional)",
  "size": "number (optional)",
  "title": "string (optional)",
  "annotations": { "audience": [], "priority": 1 },
  "meta": "JSON value"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentToolCall</code></td>
      <td>Fired when the agent makes a tool call</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "id": "string",
  "title": "string",
  "kind": "Read | Edit | EditFile | Browser | Terminal | Command | MultiEdit | ReadWithEdits | WebFetch | StrReplaceEdit",
  "status": "Pending | InProgress | Completed",
  "content": [
    { "type": "text", "text": "string" },
    { "type": "image", "data": "base64", "mimeType": "image/png" },
    { "type": "resource", "resource": { "text": "string", "uri": "string" } },
    { "type": "resourcelink", "name": "string", "uri": "string" },
    { "type": "terminal", "id": "string" },
    { "type": "diff", "path": "string", "new_text": "string", "old_text": "string (optional)" }
  ],
  "locations": [
    { "path": "string", "line": "number (optional)" }
  ],
  "input": "JSON string (optional)",
  "output": "JSON string (optional)"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentToolCallUpdate</code></td>
      <td>Fired when a tool call is updated (e.g., progress, output)</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "id": "string",
  "fields": [
    { "type": "text", "text": "string" },
    { "type": "image", "data": "base64", "mimeType": "image/png" },
    { "type": "resource", "resource": { "text": "string", "uri": "string" } },
    { "type": "resourcelink", "name": "string", "uri": "string" },
    { "type": "terminal", "id": "string" },
    { "type": "diff", "path": "string", "new_text": "string", "old_text": "string (optional)" }
  ],
  "meta": "JSON value (optional)"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentAvailableCommands</code></td>
      <td>Fired when available commands are updated</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "availableCommands": [
    {
      "name": "string",
      "description": "string",
      "input": { "hint": "string" }
    },
    {
      "name": "string",
      "description": "string"
    }
  ],
  "meta": "JSON value (optional)"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentPlan</code></td>
      <td>Fired when the agent generates a plan</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "entries": [
    { "content": "string", "priority": "High | Medium | Low" },
    { "content": "string", "priority": "High | Medium | Low" }
  ],
  "meta": "JSON value (optional)"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentCurrentMode</code></td>
      <td>Fired when the current mode changes</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "id": "string",
  "meta": "JSON value (optional)"
}</code></pre></td>
    </tr>
    <tr>
      <td><code>AgentConfigOption</code></td>
      <td>Fired when configuration options are updated</td>
      <td><pre><code class="language-json">{
  "sessionId": "string",
  "configOptions": [
    {
      "id": "string",
      "name": "string",
      "description": "string (optional)",
      "category": "string (optional)",
      "kind": {
        "currentValue": "string",
        "options": [
          { "type": "ungrouped", "value": "string", "name": "string", "description": "string (optional)" },
          { "type": "ungrouped", "value": "string", "name": "string" }
        ]
      }
    },
    {
      "id": "string",
      "name": "string",
      "category": "string (optional)",
      "kind": {
        "currentValue": "string",
        "options": [
          {
            "type": "grouped",
            "group": "string",
            "name": "string",
            "options": [
              { "value": "string", "name": "string", "description": "string (optional)" }
            ]
          }
        ]
      }
    }
  ],
  "meta": "JSON value (optional)"
}</code></pre></td>
    </tr>
  </tbody>
</table>
